/*! kDataGenerator - v1.0 - 2013-09-23 8:16:12 PM
* Copyright (c) 2013 mingzheng; Licensed  */
KISSY.add("gallery/kDataGenerator/1.0/regexp-parser",function(){function a(a,b){var c,d=0,e=b;for(e--;e>-1&&(c=a.charAt(b),"\\"===c);e--)d++;return 1==d%2}function b(e){for(var j,k,l,m,n,o=[],p=0,q=0,r=e.length;r>q;q++)switch(j=e.charAt(q)){case"|":var s=o.length;n||(n=new d("orOperatorNodeHandler",[])),n.nodelist.push(new d("plainNodeHandler",o.slice(p,s))),p=s;break;case".":o.push(new d(h["."]));break;case"\\":if(j=e[q+1],f.indexOf(j)>0){o.push(j),q++;break}j="\\"+j,g.indexOf(j)>=0&&(m=h[j],m?o.push(new d(m)):o.push(i[j]),q++);break;case"[":if(!a(e,q))for(;(k=e.indexOf("]",q))>0;)if(!a(e,k)){o.push(c(e.slice(q+1,k))),q=k;break}break;case"(":if(!a(e,q))for(;(k=e.indexOf(")",q))>0;)if(!a(e,k)){o.push(b(e.slice(q+1,k))),q=k;break}break;case"{":k=e.indexOf("}",q+1),k>0&&(j=e.slice(q+1,k),q=k);case"+":case"*":case"?":l=o.pop(),"string"==typeof l&&(l=new d("plainNodeHandle",[l])),l.opt.quantifier||(l.opt.quantifier=j),o.push(l);break;default:o.push(j)}return n?(n.nodelist.push(new d("plainNodeHandler",o.slice(p,o.length))),n):new d("plainNodeHandler",o)}function c(a){var b,c,e,i=[],j=0,k=!1;for("^"==a.charAt(0)&&(k=!0,j++),e=a.length;e>j;j++)switch(b=a.charAt(j)){case"[":break;case"\\":if(b=a[j+1],f.indexOf(b)>0){i.push(b),j++;break}b="\\"+b,g.indexOf(b)>0&&(c=h[b],c?i.push(new d(c)):i.push(b));break;default:i.push(b)}return new d("brachetNodeHandler",i,{ex:k})}function d(a,b,c){this.handlerName=a,this.nodelist=b,this.opt=c?c:{}}function e(a){var c=b(a);return c.output()}var f=["[","]","{","}","^","-","|",".","+","?","*","\\"],g=["\\w","\\d","\\c","."],h={".":"getChar","\\w":"getWordChar","\\d":"getNumber","\\c":"getChineseChar"},i={"\\n":"\r\n","\\t":"	"};return d.prototype={output:function(){var a;return a=this.opt.quantifier?this._quantifierHandler():this.getHandler().call(this)},getHandler:function(){var a=this[this.handlerName];return this.handler?this.handler:this.handler=a?a:this.plainNodeHandler},_getStrFromNode:function(a){var b;return b=a instanceof d?a.output():a},_quantifierHandler:function(){for(var a=this._parseQuantifierStr(this.opt.quantifier),b="",c=this.getHandler(),d=0;a>d;d++)b+=c.call(this);return b},_parseQuantifierStr:function(a){if("?"==a)return this.getRandom(1,10)>=6?1:0;var b=a.split(",");return 1===b.length?b[0]:this.getRandom(b[0],b[1])},brachetNodeHandler:function(){var a,b=this.nodelist;if(this.opt.ex)for(a=this.getChar();b.indexOf(a)>-1;)a=this.getChar();else a=this.orOperatorNodeHandler();return a},plainNodeHandler:function(){for(var a,b="",c=this.nodelist,d=0,e=c.length;e>d;d++)a=c[d],b+=this._getStrFromNode(a);return b},orOperatorNodeHandler:function(){var a,b=this.nodelist,c=b.length;return a=2>=c?b[this.getRandom(1,10)>=6?1:0]:b[this.getRandom(0,c-1)],this._getStrFromNode(a)},getRandom:function(a,b){return parseInt(a)+Math.round(Math.random()*(b-a))},getChar:function(){var a=this.getRandom(33,126);return String.fromCharCode(a)},getWordChar:function(){var a=this.getRandom(65,116);return a-65>=26&&(a+=6),String.fromCharCode(a)},getNumber:function(){var a=this.getRandom(48,57);return String.fromCharCode(a)},getChineseChar:function(){var a=this.getRandom(parseInt("4e00",16),parseInt("9fbf",16));return unescape("%u".concat(a.toString(16)))},_parseQuantifierStr:function(a){if("?"==a)return this.getRandom(1,10)>=6?!0:!1;var b=a.split(",");return 1===b.length?b[0]:this.getRandom(b[0],b[1])}},{parse:e}},{requires:[]}),KISSY.add("gallery/kDataGenerator/1.0/index",function(a,b){function c(a){return h(a)}function d(a,b,c){var d,e;return a?(e=a.repeatCount,e&&(d=g(e,b,c)),d):c(b)}function e(a){if("?"==a)return f(1,10)>=6?!0:!1;var b=a.split("-");return 1===b.length?b[0]:f(b[0],b[1])}function f(a,b){return parseInt(a)+Math.floor(Math.random()*(b-a))}function g(a,b,c){var d,f=e(a);if("boolean"==typeof f)return f&&(d=c(b)),d;d=[];for(var g=0;f>g;g++)d.push(c(b));return d}function h(a){var b,c=a.dataType,e=a.controler,f=a.dataItem;switch(c){case"Object":b=d(e,f,i);break;case"RegExp":b=d(e,f,j);break;case"Normal":b=d(e,f,k)}return b}function i(a){var b,c={};for(b in a)c[b]=h(a[b]);return c}function j(a){return b.parse(a)}function k(a){return a}function l(a){var b=r(a);return m(z.parse(b))}function m(a,b){var c,d,e=q(a),f={};return b||(b=""),d=B[b],f=p(a,e,b),c={controler:d,dataItem:f,dataType:e}}function n(a,b){var c,d,e={};for(c in a)d=""==b?c:b+"."+c,e[c]=m(a[c],d);return e}function o(a){return C[a]}function p(a,b,c){var d;switch(b){case"Object":d=n(a,c);break;case"RegExp":d=o(a);break;case"Normal":d=a}return d}function q(a){return"object"==typeof a?"Object":"string"==typeof a&&0==a.indexOf(A)?"RegExp":"Normal"}function r(a){for(var b,c,d,e;b=E.exec(a);)e=a.slice(0,b.index),e=s(e),c=x(e),d=w(b[1]||b[2]),B[c]=d,a=b[2]?e+a.slice(b.index+b[0].length,a.length):e+a.slice(b.index+b[0].length-1,a.length);return a}function s(a){var b,c=a.length-1,d="";if("/"!==a.charAt(c))return a;for(c--;;){if(b=a.charAt(c),"/"==b){if(v(a,c))d=b+d;else if(":"==a.charAt(c-1))break}else d=b+d;c--}return t(a.slice(0,c),d)}function t(a,b){return a+'"'+u(b)+'"'}function u(a){var b=A+D++;return C[b]=a,b}function v(a,b){var c,d=0,e=b;for(e--;e>-1&&(c=a.charAt(b),"\\"===c);e--)d++;return 1==d%2}function w(a){var b=a.split(","),c={};return c.repeatCount=b[0],c}function x(a){for(var b,c,d,e,f,g="",h=-1,i="",j=a.length-1;j>-1;j--)switch(b=a.charAt(j)){case"}":h++;break;case"{":h--;break;case":":if(0>h&&'"'==a.charAt(--j)){for(e=f=j,j--,d=a.charAt(j-1);('"'!=(c=a.charAt(j))||","!=d&&"{"!=d)&&j>-1;)e--,j--,d=a.charAt(j-1);g=a.slice(e,f)+"."+g,i="",h++}}return g=g.slice(0,g.length-1)}function y(a){return c(l(a))}var z=KISSY.JSON,A="DataGenerator_EXP_KEY",B={},C={},D=0,E=/\(([^:\(\)]*)\)[,\}]|\(([^:\(\)]*)\)$/;return{getData:y,renderData:c,format:l}},{requires:["./regexp-parser","json"]});